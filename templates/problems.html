<!DOCTYPE html>
<html lang="en">
    <head>
        <title>정글 익스프레스</title>

        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- 폰트 -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Do+Hyeon&display=swap" rel="stylesheet">

        <!-- Bulma CSS -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">
        <!-- JS -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>

        <style>
            body,title,p,span,button {
                font-family: "Do Hyeon", sans-serif;
                font-weight: 400;
                font-style: normal;
            }

            .title,p,span,body{
                color: white;
            }

            body{
                margin: 0;
                padding: 0;
                width: 100%;
                height: 100%;
                background-color: black; /* 배경색을 검정으로 설정 */
                overflow-x: hidden; /* 가로 스크롤 방지 */
            }

            

        
            .section {
                background-color: black;
                width: 800px;
                max-width: 100vw;
                margin: auto;
            }

            .numbers {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
            }

            .numbers::after {
                content: "";
                flex-basis: 100%;
                height: 0;
            }

            .button {
                flex: 1 1 calc(20% - 10px);
                margin: 5px;
                text-align: center;
            }


            
        </style>


    </head>
    <body>
        <section class="hero is-primary is-bold is-medium">
            <div class="hero-body">
                <div class="container">
                    <h1 class="title">
                        정글 탐험하기
                    </h1>
                    <h2 class="subtitle">
                        새로운 정글 캠퍼스를 디테일하게 알아가는 방법
                    </h2>
                </div>
            </div>
        </section>
        <section class="section" >
            <div class="container" id="container">
                
                {% if idName == "%" %}
                <h1 class="title">현재 게스트로 사용중입니다.</h1>
                <h2 class="subtitle">
                    <span>게스트로 사용하실 경우 해결한 <span style="color: red;">저장 및 랭킹 등록이 불가능합니다.</span> 
                    <br>가능한 로그인 이후 사용을 권장합니다.</span>
                </h2>
                {% else %}
                <h1 class="title">{{ idName }} 님의 문제 현황</h1>
                {% endif %}
                <h2 class="subtitle">
                    <span>파란색 번호는 해결한 문제, 검은색 번호는 해결하지 못한 문제입니다.
                        <br>해결하지 못한 문제를 클릭하면 해당 문제로 이동합니다. </span>
                        
                </h2>
            </div>

            <br>
            <button class="button is-primary" onclick="GoMain()">메인 화면으로 </button>
            <button class="button is-primary" onclick="GoRank()">랭킹 확인하기기 </button>

            <hr id="line">

            <div class="numbers" id="numbers">
                <button class="button is-white" onclick="ShowProblem(0)">1</button>
                <button class="button is-white" onclick="ShowProblem(1)">2</button>
                <button class="button is-white " onclick="ShowProblem(2)">3</button>
                <button class="button is-white " onclick="ShowProblem(3)">4</button>
                <button class="button is-white " onclick="ShowProblem(4)">5</button>
                <button class="button is-white " onclick="ShowProblem(5)">6</button>
                <button class="button is-white " onclick="ShowProblem(6)">7</button>
                <button class="button is-white " onclick="ShowProblem(7)">8</button>
                <button class="button is-white " onclick="ShowProblem(8)">9</button>
                <button class="button is-white " onclick="ShowProblem(9)">10</button>
                <button class="button is-white " onclick="ShowProblem(10)">11</button>
                <button class="button is-white " onclick="ShowProblem(11)">12</button>
                <button class="button is-white " onclick="ShowProblem(12)">13</button>
                <button class="button is-white " onclick="ShowProblem(13)">14</button>
                <button class="button is-white " onclick="ShowProblem(14)">15</button>
                <button class="button is-white " onclick="ShowProblem(15)">16</button>
                <button class="button is-white " onclick="ShowProblem(16)">17</button>
                <button class="button is-white " onclick="ShowProblem(17)">18</button>
                <button class="button is-white " onclick="ShowProblem(18)">19</button>
                <button class="button is-white " onclick="ShowProblem(19)">20</button>
            </div>

            <div class="problem" id="problem" style="display: none;">
                
                <img src="{{ url_for('static', filename='pika.png') }}" alt="문제 이미지" id="problemImage" reloadable="true"  />   
                <input class="input" type="text" placeholder="정답" id="answer" />
                <button class="button is-primary " onclick="comparison('{{ idName }}')">제출</button>
                <button class="button is-Warning" onclick="HideProblem()">뒤로</button>
            </div>
        </section>
        
        <script>

            Answers={
                0:["307호", "/static/image.png"],
                1:["라운지","/static/20250310_185308.jpg"]
            }



            currentProblem=0;

            window.onload = function buttonChange() {
                let id = JSON.parse('{{ idName | tojson | safe }}');

                if(id=="%"){
                    alert("게스트로 사용중입니다.");
                }
                else{
                    
                    let solvedProblems = JSON.parse('{{ solvedProblems | tojson | safe }}');  
    
                    for (let i = 0; i < 20; i++) {
                        let button = document.querySelector(`button[onclick="ShowProblem(${i})"]`);
                        if (solvedProblems[i]==true) {
                            button.classList.replace("is-white", "is-link");
                        }
                    }
    
                    console.log("Solved Problems:", solvedProblems);  // 콘솔 확인
                }
            };
            

            function ShowProblem(currentNumber){

                currentProblem=currentNumber;
                let button = document.querySelector(`button[onclick="ShowProblem(${currentProblem})"]`);

                if(button&&button.classList.contains("is-link")){
                    alert("이미 풀었습니다.");
                    return;
                }
                else{
                    
                    console.log(Answers[currentProblem][1]);
                    document.getElementById("problemImage").setAttribute('src', Answers[currentProblem][1]);

                    document.getElementById("problem").style.display ='Block';	
                    document.getElementById("container").style.display ='none';	
                    document.getElementById("numbers").style.display ='none';
                    document.getElementById("line").style.display ='none';	
                }


            }

            function HideProblem(){
                document.getElementById("problem").style.display ='none';
                document.getElementById("container").style.display ='Block';
                document.getElementById("numbers").style.display ='Block';	
                document.getElementById("numbers").style.display ='flex';	
                document.getElementById("line").style.display ='Block';
                document.getElementById("answer").value=''; 

            }

            function comparison(idName){
                idName = idName.toString();
                document.getElementById("answer").value;
                if(document.getElementById("answer").value == Answers[currentProblem][0]){
                    alert("정답입니다.");
                    //db 업데이트
                    if(idName!="%"){
                        $.ajax({
                            type: "POST",
                            url: "/api/problems",
                            data: {id_give: idName, number_give: currentProblem},
                            success: function(response) {
                                if (response['result'] == "success") {
                                    console.log("ppap"); // 문제 해결 상태 저장 성공
                                } else {
                                    console.log(response['msg']); // 오류 메시지 표시
                                }
                            },
                            error: function() {
                                alert("서버 요청 중 오류가 발생했습니다.");
                            }
                        });

                    }

                    // 버튼 색 변경

                    let button = document.querySelector(`button[onclick="ShowProblem(${currentProblem})"]`);

                    if (button) {
                        button.classList.replace("is-white", "is-link");
                    }


                    HideProblem();
                    
                }else{
                    alert("틀렸습니다.");
                }
            }

            function GoMain(){
                window.location.href='/'
            }

            function GoRank(){
                window.location.href='/ranking'
            }

            
        </script>
    </body>

        
</html>